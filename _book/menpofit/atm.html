
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Active Template Model Â· The Menpo Project</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="The Menpo Team">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="landmark_localization.html" />
    
    
    <link rel="prev" href="deformable_image_alignment.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Table of Contents</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    The Menpo Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installation/conda.html">
            
                <a href="../installation/conda.html">
            
                    
                    Conda
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../installation/windows/">
            
                <a href="../installation/windows/">
            
                    
                    Windows
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" data-path="../installation/windows/beginner.md">
            
                <span>
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.2" data-path="../installation/windows/expert.md">
            
                <span>
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../installation/macos/">
            
                <a href="../installation/macos/">
            
                    
                    macOS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1" data-path="../installation/macos/beginner.html">
            
                <a href="../installation/macos/beginner.html">
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.2" data-path="../installation/macos/expert.html">
            
                <a href="../installation/macos/expert.html">
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../installation/linux/">
            
                <a href="../installation/linux/">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.3.1" data-path="../installation/linux/beginner.html">
            
                <a href="../installation/linux/beginner.html">
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.2" data-path="../installation/linux/expert.html">
            
                <a href="../installation/linux/expert.html">
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../installation/expert_quick_start.html">
            
                <a href="../installation/expert_quick_start.html">
            
                    
                    Expert Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="../installation/development.html">
            
                <a href="../installation/development.html">
            
                    
                    Development
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installation/pip.html">
            
                <a href="../installation/pip.html">
            
                    
                    Pip
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../menpo/">
            
                <a href="../menpo/">
            
                    
                    menpo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../menpo/introduction.html">
            
                <a href="../menpo/introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../menpo/datatypes.html">
            
                <a href="../menpo/datatypes.html">
            
                    
                    Data Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../menpo/consistency.html">
            
                <a href="../menpo/consistency.html">
            
                    
                    Consistency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../menpo/vectorizing.html">
            
                <a href="../menpo/vectorizing.html">
            
                    
                    Vectorizing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../menpo/visualization.html">
            
                <a href="../menpo/visualization.html">
            
                    
                    Visualization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" >
            
                <a target="_blank" href="https://menpo.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="./">
            
                <a href="./">
            
                    
                    menpofit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="basics.html">
            
                <a href="basics.html">
            
                    
                    Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="importing.html">
            
                <a href="importing.html">
            
                    
                    Importing Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="training.html">
            
                <a href="training.html">
            
                    
                    Training
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="fitting.html">
            
                <a href="fitting.html">
            
                    
                    Fitting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="result.html">
            
                <a href="result.html">
            
                    
                    Fitting Result
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="visualization.html">
            
                <a href="visualization.html">
            
                    
                    Visualizing Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="experiments.html">
            
                <a href="experiments.html">
            
                    
                    Running Experiments
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="pdm.html">
            
                <a href="pdm.html">
            
                    
                    Point Distribution Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="affine_image_alignment.html">
            
                <a href="affine_image_alignment.html">
            
                    
                    Affine Image Alignment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="lk.html">
            
                <a href="lk.html">
            
                    
                    Lucas-Kanade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="deformable_image_alignment.html">
            
                <a href="deformable_image_alignment.html">
            
                    
                    Deformable Image Alignment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.4.4.1" data-path="atm.html">
            
                <a href="atm.html">
            
                    
                    Active Template Model
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="landmark_localization.html">
            
                <a href="landmark_localization.html">
            
                    
                    Landmark Localization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="aam.html">
            
                <a href="aam.html">
            
                    
                    Active Appearance Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="aps.html">
            
                <a href="aps.html">
            
                    
                    Active Pictorial Structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="clm.html">
            
                <a href="clm.html">
            
                    
                    Constrained Local Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="sdm.html">
            
                <a href="sdm.html">
            
                    
                    Supervised Descent Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.5" data-path="ert.html">
            
                <a href="ert.html">
            
                    
                    Ensemble of Regression Trees
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="references.html">
            
                <a href="references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <a target="_blank" href="https://menpofit.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../menpodetect/">
            
                <a href="../menpodetect/">
            
                    
                    menpodetect
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <a target="_blank" href="https://menpodetect.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../menpo3d/">
            
                <a href="../menpo3d/">
            
                    
                    menpo3d
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../menpocli/">
            
                <a href="../menpocli/">
            
                    
                    menpocli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../landmarkerio/">
            
                <a href="../landmarkerio/">
            
                    
                    landmarker.io
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../landmarkerio/specifications.html">
            
                <a href="../landmarkerio/specifications.html">
            
                    
                    Specifications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../landmarkerio/userguide.html">
            
                <a href="../landmarkerio/userguide.html">
            
                    
                    User Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../landmarkerio/snap_mode.html">
            
                <a href="../landmarkerio/snap_mode.html">
            
                    
                    Snap Mode
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../examples/">
            
                <a href="../examples/">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../manifesto.html">
            
                <a href="../manifesto.html">
            
                    
                    Manifesto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../team.html">
            
                <a href="../team.html">
            
                    
                    The Menpo Team
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../citation.html">
            
                <a href="../citation.html">
            
                    
                    Citation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../faq.html">
            
                <a href="../faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Active Template Model</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="active-template-model">Active Template Model</h1>
<ol>
<li><a href="#definition">Definition</a></li>
<li><a href="#warp">Warp Functions</a></li>
<li><a href="#cost">Cost Function and Optimization</a></li>
<li><a href="#references">References</a></li>
<li><a href="http://menpofit.readthedocs.io/en/stable/api/menpofit/atm/index.html" target="_blank">API Documentation <i class="fa fa-external-link fa-lg"></i></a></li>
</ol>
<hr>
<p><div style="background-color: #F2DEDE; width: 100%; border: 1px solid #A52A2A; padding: 1%;">
<p style="float: left;"><i class="fa fa-exclamation-circle" aria-hidden="true" style="font-size:4em; padding-right: 15%; padding-bottom: 10%; padding-top: 10%;"></i></p>
We highly recommend that you render all matplotlib figures <b>inline</b> the Jupyter notebook for the best <a href="../menpowidgets/index.md"><em>menpowidgets</em></a> experience.
This can be done by running<br>
<center><code>%matplotlib inline</code></center>
in a cell. Note that you only have to run it once and not in every rendering cell.
</div></p>

<h3 id="definition">1. Definition </h3>
<p>The aim of deformable image alignment is to find the optimal alignment between a constant template and an input image with rspect to the parameters of a parametric shape model.
Active Template Model (ATM) is such method which is inspired by the <a href="lk.html" title="Lucas-Kanade Affine Image Alignment">Lucas-Kanade Affine Image Alignment</a> and the <a href="aam.html" title="Active Appearance Model">Active Appearance Model</a>. Note that we invented the name &quot;Active Template Model&quot; for the purpose of the Menpo Project. The term is not established in literature. In this page, we provide a basic mathematical definition of an ATM and all its variations that are implemented within <code>menpofit</code>.</p>
<p>A shape instance of a deformable object is represented as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">s</mi></mrow><mo>=</mo><mo fence="false">[</mo><msub><mi>x</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>y</mi><mn>1</mn></msub><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><msub><mi>x</mi><mi>L</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>L</mi></msub><msup><mo fence="false">]</mo><mrow><mrow><mi mathvariant="sans-serif">T</mi></mrow></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbf{s}=\big[x_1,y_1,\ldots,x_L,y_L\big]^{\mathsf{T}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.950108em;"></span><span class="strut bottom" style="height:1.3001179999999999em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="mrel">=</span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="minner">&#x2026;</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">L</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">L</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">]</span></span><span class="msupsub"><span class="vlist"><span style="top:-0.46399999999999997em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathsf mtight">T</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span>, a <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mn>2</mn><mi>L</mi><mo>&#xD7;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">2L\times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathrm">2</span><span class="mord mathit">L</span><span class="mbin">&#xD7;</span><span class="mord mathrm">1</span></span></span></span> vector consisting of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span></span></span></span> landmark points coordinates <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo>(</mo><msub><mi>x</mi><mi>i</mi></msub><mo separator="true">,</mo><msub><mi>y</mi><mi>i</mi></msub><mo>)</mo><mo separator="true">,</mo><mi mathvariant="normal">&#x2200;</mi><mi>i</mi><mo>=</mo><mn>1</mn><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><mi>L</mi></mrow><annotation encoding="application/x-tex">(x_i,y_i),\forall i=1,\ldots,L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mopen">(</span><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit" style="margin-right:0.03588em;">y</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:-0.03588em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">i</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mord mathrm">&#x2200;</span><span class="mord mathit">i</span><span class="mrel">=</span><span class="mord mathrm">1</span><span class="mpunct">,</span><span class="minner">&#x2026;</span><span class="mpunct">,</span><span class="mord mathit">L</span></span></span></span>. An ATM is constructed using a template image that is annotated with <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>L</mi></mrow><annotation encoding="application/x-tex">L</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">L</span></span></span></span> landmark points and a set of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>N</mi></mrow><annotation encoding="application/x-tex">N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.68333em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">N</span></span></span></span> shapes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="false">{</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mn>1</mn></msub><mo separator="true">,</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mn>2</mn></msub><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mi>N</mi></msub><mo fence="false">}</mo></mrow><annotation encoding="application/x-tex">\big\lbrace\mathbf{s}_1,\mathbf{s}_2,\ldots,\mathbf{s}_N\big\rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.85em;"></span><span class="strut bottom" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">{</span></span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="minner">&#x2026;</span><span class="mpunct">,</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">}</span></span></span></span></span> that are essential for building the hsape model. Specifically, it consists of the following parts:</p>
<ul>
<li><p><strong>Shape Model</strong><br>The shape model is trained as explained in the <a href="pdm.html" title="Point Distribution Model basics">Point Distributon Model section</a>. The training shapes <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="false">{</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mn>1</mn></msub><mo separator="true">,</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mn>2</mn></msub><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><msub><mrow><mi mathvariant="bold">s</mi></mrow><mi>N</mi></msub><mo fence="false">}</mo></mrow><annotation encoding="application/x-tex">\big\lbrace\mathbf{s}_1,\mathbf{s}_2,\ldots,\mathbf{s}_N\big\rbrace</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.85em;"></span><span class="strut bottom" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">{</span></span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="minner">&#x2026;</span><span class="mpunct">,</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight" style="margin-right:0.10903em;">N</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">}</span></span></span></span></span> are first aligned using Generalized Procrustes Analysis and then an orthonormal basis is created using Principal Component Analysis (PCA) which is further augmented with four eigenvectors that represent the similarity transform (scaling, in-plane rotation and translation). This results in
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mo fence="false">{</mo><mover accent="true"><mrow><mrow><mi mathvariant="bold">s</mi></mrow></mrow><mo>&#xAF;</mo></mover><mo separator="true">,</mo><msub><mrow><mi mathvariant="bold">U</mi></mrow><mi>s</mi></msub><mo fence="false">}</mo></mrow><annotation encoding="application/x-tex">
  \big\lbrace\bar{\mathbf{s}}, \mathbf{U}_s\big\rbrace
  </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.85em;"></span><span class="strut bottom" style="height:1.20001em;vertical-align:-0.35001em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">{</span></span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord displaystyle textstyle cramped"><span class="mord displaystyle textstyle cramped"><span class="mord mathbf">s</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">U</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">}</span></span></span></span></span></span>
where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="bold">U</mi></mrow><mi>s</mi></msub><mo>&#x2208;</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><mn>2</mn><mi>L</mi><mo>&#xD7;</mo><mi>n</mi></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbf{U}_s\in\mathbb{R}^{2L\times n}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:0.991331em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">U</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mrel">&#x2208;</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathrm mtight">2</span><span class="mord mathit mtight">L</span><span class="mbin mtight">&#xD7;</span><span class="mord mathit mtight">n</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span> is the orthonormal basis of <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>n</mi></mrow><annotation encoding="application/x-tex">n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.43056em;"></span><span class="strut bottom" style="height:0.43056em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord mathit">n</span></span></span></span> eigenvectors (including the four similarity components) and <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mrow><mi mathvariant="bold">s</mi></mrow></mrow><mo>&#xAF;</mo></mover><mo>&#x2208;</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><mn>2</mn><mi>L</mi><mo>&#xD7;</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\bar{\mathbf{s}}\in\mathbb{R}^{2L\times 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:0.880431em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">s</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mrel">&#x2208;</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathrm mtight">2</span><span class="mord mathit mtight">L</span><span class="mbin mtight">&#xD7;</span><span class="mord mathrm mtight">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span> is the mean shape vector. An new shape instance can be generated as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="bold">s</mi></mrow><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow></msub><mo>=</mo><mover accent="true"><mrow><mrow><mi mathvariant="bold">s</mi></mrow></mrow><mo>&#xAF;</mo></mover><mo>+</mo><msub><mrow><mi mathvariant="bold">U</mi></mrow><mi>s</mi></msub><mrow><mi mathvariant="bold">p</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{s}_{\mathbf{p}}=\bar{\mathbf{s}} + \mathbf{U}_s\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68611em;"></span><span class="strut bottom" style="height:0.972218em;vertical-align:-0.286108em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord scriptstyle cramped mtight"><span class="mord scriptstyle cramped mtight"><span class="mord mathbf mtight">p</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mrel">=</span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">s</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mbin">+</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">U</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">s</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span></span></span></span>, where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">p</mi></mrow><mo>=</mo><mo fence="false">[</mo><msub><mi>p</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>p</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>&#x2026;</mo><mo separator="true">,</mo><msub><mi>p</mi><mi>n</mi></msub><msup><mo fence="false">]</mo><mrow><mrow><mi mathvariant="sans-serif">T</mi></mrow></mrow></msup></mrow><annotation encoding="application/x-tex">\mathbf{p}=\big[p_1,p_2,\ldots,p_n\big]^{\mathsf{T}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.950108em;"></span><span class="strut bottom" style="height:1.3001179999999999em;vertical-align:-0.35001em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mrel">=</span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">[</span></span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">1</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathrm mtight">2</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mpunct">,</span><span class="minner">&#x2026;</span><span class="mpunct">,</span><span class="mord"><span class="mord mathit">p</span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">n</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing size1">]</span></span><span class="msupsub"><span class="vlist"><span style="top:-0.46399999999999997em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathsf mtight">T</span></span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span> is the vector of shape parameters.</p>
</li>
<li><p><strong>Motion Model</strong><br>The motion model consists of a warp function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}(\mathbf{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span></span></span></span> which is essential for warping the texture related to a shape instance generated with parameters <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44444em;"></span><span class="strut bottom" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span></span></span></span> into a common <code>reference_shape</code>. The <code>reference_shape</code> is by default the mean shape <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mrow><mi mathvariant="bold">s</mi></mrow></mrow><mo>&#xAF;</mo></mover></mrow><annotation encoding="application/x-tex">\bar{\mathbf{s}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58122em;"></span><span class="strut bottom" style="height:0.58122em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">s</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0.11112em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span>, however you can pass in a <code>reference_shape</code> of your preference during construction of the ATM.</p>
</li>
<li><p><strong>Template</strong><br>The provided template image <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="bold">I</mi></mrow><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{I}_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68611em;"></span><span class="strut bottom" style="height:0.83611em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">I</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span> which is annotated with landmarks <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mrow><mi mathvariant="bold">s</mi></mrow><mi>a</mi></msub></mrow><annotation encoding="application/x-tex">\mathbf{s}_a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44444em;"></span><span class="strut bottom" style="height:0.59444em;vertical-align:-0.15em;"></span><span class="base textstyle uncramped"><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">s</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span> is further processed by:</p>
<ol>
<li>First extracting features using the features function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{F}()</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mclose">)</span></span></span></span> defined by <code>holistic_features</code>, i.e. <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><msub><mrow><mi mathvariant="bold">I</mi></mrow><mi>a</mi></msub><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{F}(\mathbf{I}_a)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">I</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span></span></span></span></li>
<li>Warping the feature-based image into the <code>reference_shape</code> in order to get <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><msub><mrow><mi mathvariant="bold">I</mi></mrow><mi>a</mi></msub><mo>)</mo><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><msub><mrow><mi mathvariant="bold">p</mi></mrow><mi>a</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{F}(\mathbf{I}_a)(\mathcal{W}(\mathbf{p}_a))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">I</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></li>
<li>Vectorizing the warped image as <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mrow><mi mathvariant="bold">a</mi></mrow></mrow><mo>&#xAF;</mo></mover><mo>=</mo><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><msub><mrow><mi mathvariant="bold">I</mi></mrow><mi>a</mi></msub><mo>)</mo><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><msub><mrow><mi mathvariant="bold">p</mi></mrow><mi>a</mi></msub><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\bar{\mathbf{a}} = \mathcal{F}(\mathbf{I}_a)(\mathcal{W}(\mathbf{p}_a))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">a</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mrel">=</span><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">I</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="msupsub"><span class="vlist"><span style="top:0.15em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord mathit mtight">a</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> where <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mrow><mi mathvariant="bold">a</mi></mrow></mrow><mo>&#xAF;</mo></mover><mo>&#x2208;</mo><msup><mrow><mi mathvariant="double-struck">R</mi></mrow><mrow><mi>M</mi><mo>&#xD7;</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\bar{\mathbf{a}}\in\mathbb{R}^{M\times 1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.8413309999999999em;"></span><span class="strut bottom" style="height:0.880431em;vertical-align:-0.0391em;"></span><span class="base textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">a</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mrel">&#x2208;</span><span class="mord"><span class="mord textstyle uncramped"><span class="mord mathbb">R</span></span><span class="msupsub"><span class="vlist"><span style="top:-0.363em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathit mtight" style="margin-right:0.10903em;">M</span><span class="mbin mtight">&#xD7;</span><span class="mord mathrm mtight">1</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span></li>
</ol>
</li>
</ul>
<p>Let&apos;s first load a test image and a template image <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mover accent="true"><mrow><mrow><mi mathvariant="bold">a</mi></mrow></mrow><mo>&#xAF;</mo></mover></mrow><annotation encoding="application/x-tex">\bar{\mathbf{a}}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.58122em;"></span><span class="strut bottom" style="height:0.58122em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord textstyle cramped"><span class="mord textstyle cramped"><span class="mord mathbf">a</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span>. We&apos;ll load two images of the same person (Amanda Peet, actress)
from LFPW trainset (see <a href="importing.html" title="Basics on how to import images">Importing Images</a> for download instructions).</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path
<span class="hljs-keyword">import</span> menpo.io <span class="hljs-keyword">as</span> mio

path_to_lfpw = Path(<span class="hljs-string">&apos;/path/to/lfpw/trainset/&apos;</span>)

image = mio.import_image(path_to_lfpw / <span class="hljs-string">&apos;image_0004.png&apos;</span>)
image = image.crop_to_landmarks_proportion(<span class="hljs-number">0.5</span>)

template = mio.import_image(path_to_lfpw / <span class="hljs-string">&apos;image_0005.png&apos;</span>)
template = template.crop_to_landmarks_proportion(<span class="hljs-number">0.5</span>)
</code></pre>
<p>The image and template can be visualized as:</p>
<pre><code class="lang-python">%matplotlib inline
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.subplot(<span class="hljs-number">121</span>)
image.view()
plt.gca().set_title(<span class="hljs-string">&apos;Input Image&apos;</span>)

plt.subplot(<span class="hljs-number">122</span>)
template.view_landmarks(marker_face_colour=<span class="hljs-string">&apos;white&apos;</span>, marker_edge_colour=<span class="hljs-string">&apos;black&apos;</span>,
                        marker_size=<span class="hljs-number">4</span>)
plt.gca().set_title(<span class="hljs-string">&apos;Template&apos;</span>);
</code></pre>
<center>
  <img src="media/atm_template.png" alt="Template image">
</center>

<p>Let&apos;s also load the shapes of LFPW trainset that will be used in order to train the PDM:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> menpo.visualize <span class="hljs-keyword">import</span> print_progress

training_shapes = []
<span class="hljs-keyword">for</span> lg <span class="hljs-keyword">in</span> print_progress(mio.import_landmark_files(path_to_lfpw / <span class="hljs-string">&apos;*.pts&apos;</span>, verbose=<span class="hljs-keyword">True</span>)):
    training_shapes.append(lg[<span class="hljs-string">&apos;all&apos;</span>])
</code></pre>
<p>The shapes can be visualized using a widget as:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> menpowidgets <span class="hljs-keyword">import</span> visualize_pointclouds
visualize_pointclouds(training_shapes)
</code></pre>
<video width="100%" autoplay loop>
  <source src="media/visualize_pointclouds_lfpw.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>


<h3 id="warp">2. Warp Functions </h3>
<p>With an abuse of notation, let us define
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">t</mi></mrow><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo><mo>)</mo><mo>&#x2261;</mo><mrow><mi mathvariant="script">F</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">I</mi></mrow><mo>)</mo><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">
\mathbf{t}(\mathcal{W}(\mathbf{p}))\equiv \mathcal{F}(\mathbf{I})(\mathcal{W}(\mathbf{p}))
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base displaystyle textstyle uncramped"><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">t</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mrel">&#x2261;</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.09931em;">F</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">I</span></span><span class="mclose">)</span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span>
as the feature-based warped <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>M</mi><mo>&#xD7;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">M\times 1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68333em;"></span><span class="strut bottom" style="height:0.76666em;vertical-align:-0.08333em;"></span><span class="base textstyle uncramped"><span class="mord mathit" style="margin-right:0.10903em;">M</span><span class="mbin">&#xD7;</span><span class="mord mathrm">1</span></span></span></span> vector of an image <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">I</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{I}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.68611em;"></span><span class="strut bottom" style="height:0.68611em;vertical-align:0em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">I</span></span></span></span></span> given its shape instance generated with parameters <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44444em;"></span><span class="strut bottom" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span></span></span></span>.</p>
<p><code>menpofit</code> provides five different ATM versions, which differ on the way that this appearance warping <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">t</mi></mrow><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathbf{t}(\mathcal{W}(\mathbf{p}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">t</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> is performed.
Specifically:</p>
<p><strong>HolisticATM</strong><br>The <code>HolisticATM</code> uses a holistic appearance representation obtained by warping the texture into the reference frame
with a non-linear warp function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}(\mathbf{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span></span></span></span>. Two such warp functions are currently supported:
Piecewise Affine Warp and Thin Plate Spline. The reference frame is the mask of the mean shape&apos;s convex hull.</p>
<p><strong>MaskedATM</strong><br>The <code>MaskedATM</code> uses the same warp logic as the <code>HolsiticATM</code>. The only difference between them is that the
reference frame consists of rectangular mask patches centered around the landmarks instead of the convex hull of the mean shape.</p>
<p><strong>LinearATM</strong><br>The <code>LinearATM</code> is an experimental variation that utilizes a linear warp function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}(\mathbf{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span></span></span></span> in the motion model, thus a <em>dense</em> statistical shape model which has one shape point per pixel in the reference frame. The advantage is that the linear nature of such warp function makes the computation of its Jacobian trivial.</p>
<p><strong>LinearMaskedATM</strong><br>Similar to the relation between <code>HolisticATM</code> and <code>MaskedATM</code>, a <code>LinearMaskedATM</code> is exactly the same with a
<code>LinearATM</code>, with the difference that the reference frame is masked.</p>
<p><strong>PatchATM</strong><br>A <code>PatchATM</code> represents the appearance in a patch-based fashion, i.e. rectangular patches are extracted around the landmark points.
Thus, the warp function <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">t</mi></mrow><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathbf{t}(\mathcal{W}(\mathbf{p}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">t</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span> simply <em>samples</em> the patches centered around the landmarks of the shape instance generated with parameters <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44444em;"></span><span class="strut bottom" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span></span></span></span>.</p>
<p>Let&apos;s now create a <code>HolisticATM</code> using IGO features:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> menpofit.atm <span class="hljs-keyword">import</span> HolisticATM
<span class="hljs-keyword">from</span> menpo.feature <span class="hljs-keyword">import</span> igo

atm = HolisticATM(template, training_shapes, group=<span class="hljs-string">&apos;PTS&apos;</span>,
                  diagonal=<span class="hljs-number">180</span>, scales=(<span class="hljs-number">0.25</span>, <span class="hljs-number">1.0</span>),
                  holistic_features=igo, verbose=<span class="hljs-keyword">True</span>)
</code></pre>
<p>and visualize it:</p>
<pre><code class="lang-python">atm.view_shape_models_widget()
</code></pre>
<video width="100%" autoplay loop>
  <source src="media/view_shape_models_widget.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>

<pre><code class="lang-python">atm.view_atm_widget()
</code></pre>
<video width="100%" autoplay loop>
  <source src="media/atm_view_widget.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>


<h3 id="cost">3. Cost Function and Optimization </h3>
<p>Fitting an ATM on a test image involves the optimization of the following cost function
<span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>arg</mi><msub><mi>min</mi><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow></msub><mo fence="false">&#x2225;</mo><mrow><mi mathvariant="bold">t</mi></mrow><mo>(</mo><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo><mo>)</mo><mo>&#x2212;</mo><mover accent="true"><mrow><mrow><mi mathvariant="bold">a</mi></mrow></mrow><mo>&#xAF;</mo></mover><msup><mo fence="false">&#x2225;</mo><mrow><mn>2</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
\arg\min_{\mathbf{p}} \big\lVert \mathbf{t}(\mathcal{W}(\mathbf{p})) - \bar{\mathbf{a}} \big\rVert^{2}
</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.927098em;"></span><span class="strut bottom" style="height:1.7632059999999998em;vertical-align:-0.8361079999999999em;"></span><span class="base displaystyle textstyle uncramped"><span class="mop">ar<span style="margin-right:0.01389em;">g</span></span><span class="mop op-limits"><span class="vlist"><span style="top:0.5999999999999999em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle cramped mtight"><span class="mord scriptstyle cramped mtight"><span class="mord scriptstyle cramped mtight"><span class="mord mathbf mtight">p</span></span></span></span></span><span style="top:-5.551115123125783e-17em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span><span class="mop">min</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.35000999999999993em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="delimsizinginner delim-size1"><span>&#x2225;</span></span></span><span style="top:-0.25599000000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="delimsizinginner delim-size1"><span>&#x2225;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">t</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord displaystyle textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span><span class="mclose">)</span><span class="mbin">&#x2212;</span><span class="mord accent"><span class="vlist"><span style="top:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="mord displaystyle textstyle cramped"><span class="mord displaystyle textstyle cramped"><span class="mord mathbf">a</span></span></span></span><span style="top:-0.013440000000000007em;margin-left:0em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="accent-body"><span>&#xAF;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span><span class="mord"><span class="mord style-wrap reset-textstyle textstyle uncramped"><span class="delimsizing mult"><span class="vlist"><span style="top:0.35000999999999993em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="delimsizinginner delim-size1"><span>&#x2225;</span></span></span><span style="top:-0.25599000000000005em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="delimsizinginner delim-size1"><span>&#x2225;</span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span><span class="msupsub"><span class="vlist"><span style="top:-0.47599em;margin-right:0.05em;"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span><span class="reset-textstyle scriptstyle uncramped mtight"><span class="mord scriptstyle uncramped mtight"><span class="mord mathrm mtight">2</span></span></span></span><span class="baseline-fix"><span class="fontsize-ensurer reset-size5 size5"><span style="font-size:0em;">&#x200B;</span></span>&#x200B;</span></span></span></span></span></span></span></span>
with respect to the shape parameters. Note that this cost function is exactly the same as in the case of <a href="lk.html" title="Lucas-Kanade Affine Image Alignment">Lucas-Kanade</a> for Affine Image Alignment. The only difference has to do with the nature of the transform - and thus <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="bold">p</mi></mrow></mrow><annotation encoding="application/x-tex">\mathbf{p}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.44444em;"></span><span class="strut bottom" style="height:0.63888em;vertical-align:-0.19444em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span></span></span></span> - that is used in the motion model <span class="katex"><span class="katex-mathml"><math><semantics><mrow><mrow><mi mathvariant="script">W</mi></mrow><mo>(</mo><mrow><mi mathvariant="bold">p</mi></mrow><mo>)</mo></mrow><annotation encoding="application/x-tex">\mathcal{W}(\mathbf{p})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height:0.75em;"></span><span class="strut bottom" style="height:1em;vertical-align:-0.25em;"></span><span class="base textstyle uncramped"><span class="mord textstyle uncramped"><span class="mord mathcal" style="margin-right:0.08222em;">W</span></span><span class="mopen">(</span><span class="mord textstyle uncramped"><span class="mord mathbf">p</span></span><span class="mclose">)</span></span></span></span>. Similarly, the cost function is very similar to the one of an <a href="aam.html" title="Active Appearance Model (AAM)">Active Appearance Model</a> with the difference that an ATM has no appearance subspace.</p>
<p>The optimization of the ATM deformable image alignment is performed with the Lucas-Kanade gradient descent algorithm.
This is the same as in the case of affine image transform, so you can refer to the <a href="lk.html" title="Lucas-Kanade Affine Image Alignment">Lucas-Kanade</a> chapter
for more information. We currently support Inverse-Compositional and Forward-Compositional optimization.</p>
<p>Let&apos;s now create a <code>Fitter</code> using the ATM we created, as:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> menpofit.atm <span class="hljs-keyword">import</span> LucasKanadeATMFitter, InverseCompositional

fitter = LucasKanadeATMFitter(atm,
                              lk_algorithm_cls=InverseCompositional, n_shape=[<span class="hljs-number">5</span>, <span class="hljs-number">15</span>])
</code></pre>
<p>Information about the fitter can be retrieved as:</p>
<pre><code class="lang-python">print(fitter)
</code></pre>
<p>which returns</p>
<pre><code>Holistic Active Template Model
 - Images warped with DifferentiablePiecewiseAffine transform
 - Images scaled to diagonal: 180.00
 - Scales: [0.25, 1.0]
   - Scale 0.25
     - Holistic feature: igo
     - Template shape: (38, 38)
     - Shape model class: OrthoPDM
       - 132 shape components
       - 4 similarity transform parameters
   - Scale 1.0
     - Holistic feature: igo
     - Template shape: (133, 134)
     - Shape model class: OrthoPDM
       - 132 shape components
       - 4 similarity transform parameters
Inverse Compositional Algorithm
 - Scales: [0.25, 1.0]
   - Scale 0.25
     - 3 active shape components
     - 4 similarity transform components
   - Scale 1.0
     - 20 active shape components
     - 4 similarity transform components
</code></pre><p>Let&apos;s know fit the ATM on the <code>image</code> we loaded in the beggining.
We will use the DLib face detector from <a href="../menpodetect/"><code>menpodetect</code></a>, in order to acquire an initial bounding box, as:</p>
<pre><code class="lang-python"><span class="hljs-keyword">from</span> menpodetect <span class="hljs-keyword">import</span> load_dlib_frontal_face_detector

<span class="hljs-comment"># Load detector</span>
detect = load_dlib_frontal_face_detector()

<span class="hljs-comment"># Detect</span>
bboxes = detect(image)
print(<span class="hljs-string">&quot;{} detected faces.&quot;</span>.format(len(bboxes)))

<span class="hljs-comment"># View</span>
<span class="hljs-keyword">if</span> len(bboxes) &gt; <span class="hljs-number">0</span>:
    image.view_landmarks(group=<span class="hljs-string">&apos;dlib_0&apos;</span>, line_colour=<span class="hljs-string">&apos;white&apos;</span>,
                         render_markers=<span class="hljs-keyword">False</span>, line_width=<span class="hljs-number">3</span>);
</code></pre>
<center>
  <img src="media/atm_view_bbox.png" alt="Visualize detected bounding box">
</center>

<p>and fit the ATM as:</p>
<pre><code class="lang-python"><span class="hljs-comment"># initial bbox</span>
initial_bbox = bboxes[<span class="hljs-number">0</span>]

<span class="hljs-comment"># fit image</span>
result = fitter.fit_from_bb(image, initial_bbox, max_iters=<span class="hljs-number">20</span>,
                            gt_shape=image.landmarks[<span class="hljs-string">&apos;PTS&apos;</span>].lms)

<span class="hljs-comment"># print result</span>
print(result)
</code></pre>
<p>which prints</p>
<pre><code>Fitting result of 68 landmark points.
Initial error: 0.0877
Final error: 0.0196
</code></pre><p>The result can be visualized as:</p>
<pre><code class="lang-python">result.view(render_initial_shape=<span class="hljs-keyword">True</span>)
</code></pre>
<center>
  <img src="media/atm_view_result.png" alt="Visualize_fitting_result">
</center>

<p>or using a widget as:</p>
<pre><code class="lang-python">result.view_widget()
</code></pre>
<video width="100%" autoplay loop>
  <source src="media/atm_result_view_widget.mp4" type="video/mp4">
Your browser does not support the video tag.
</video>

<p>Remember that the shape per iteration can be retrieved as</p>
<pre><code class="lang-python">result.shapes
</code></pre>
<p>Similarly, the shape and appearance parameters per iteration can be obtained as:</p>
<pre><code class="lang-python">print(result.shape_parameters.shape)
print(result.appearance_parameters.shape)
</code></pre>
<h3 id="references">4. References </h3>
<p id="1">[1] I. Matthews, and S. Baker. &quot;Active Appearance Models Revisited&quot;, International Journal of Computer Vision, vol. 60, no. 2, pp. 135-164, 2004.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="deformable_image_alignment.html" class="navigation navigation-prev " aria-label="Previous page: Deformable Image Alignment">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="landmark_localization.html" class="navigation navigation-next " aria-label="Next page: Landmark Localization">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Active Template Model","level":"1.4.4.1","depth":3,"next":{"title":"Landmark Localization","level":"1.4.5","depth":2,"path":"menpofit/landmark_localization.md","ref":"menpofit/landmark_localization.md","articles":[{"title":"Active Appearance Model","level":"1.4.5.1","depth":3,"path":"menpofit/aam.md","ref":"menpofit/aam.md","articles":[]},{"title":"Active Pictorial Structures","level":"1.4.5.2","depth":3,"path":"menpofit/aps.md","ref":"menpofit/aps.md","articles":[]},{"title":"Constrained Local Model","level":"1.4.5.3","depth":3,"path":"menpofit/clm.md","ref":"menpofit/clm.md","articles":[]},{"title":"Supervised Descent Method","level":"1.4.5.4","depth":3,"path":"menpofit/sdm.md","ref":"menpofit/sdm.md","articles":[]},{"title":"Ensemble of Regression Trees","level":"1.4.5.5","depth":3,"path":"menpofit/ert.md","ref":"menpofit/ert.md","articles":[]}]},"previous":{"title":"Deformable Image Alignment","level":"1.4.4","depth":2,"path":"menpofit/deformable_image_alignment.md","ref":"menpofit/deformable_image_alignment.md","articles":[{"title":"Active Template Model","level":"1.4.4.1","depth":3,"path":"menpofit/atm.md","ref":"menpofit/atm.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["toggle-chapters","katex","ga"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-52093814-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"theme":"default","author":"The Menpo Team","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"homepage.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"The Menpo Project","gitbook":"3.2.3"},"file":{"path":"menpofit/atm.md","mtime":"2019-11-16T13:08:54.346Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-16T13:57:33.647Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

