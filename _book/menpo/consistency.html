
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Consistency Â· The Menpo Project</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="The Menpo Team">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="vectorizing.html" />
    
    
    <link rel="prev" href="datatypes.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Table of Contents</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    The Menpo Project
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../installation/">
            
                <a href="../installation/">
            
                    
                    Installation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../installation/conda.html">
            
                <a href="../installation/conda.html">
            
                    
                    Conda
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1" data-path="../installation/windows/">
            
                <a href="../installation/windows/">
            
                    
                    Windows
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.1.1" data-path="../installation/windows/beginner.md">
            
                <span>
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.1.2" data-path="../installation/windows/expert.md">
            
                <span>
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.2" data-path="../installation/macos/">
            
                <a href="../installation/macos/">
            
                    
                    macOS
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.2.1" data-path="../installation/macos/beginner.html">
            
                <a href="../installation/macos/beginner.html">
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.2.2" data-path="../installation/macos/expert.html">
            
                <a href="../installation/macos/expert.html">
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.3" data-path="../installation/linux/">
            
                <a href="../installation/linux/">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1.3.1" data-path="../installation/linux/beginner.html">
            
                <a href="../installation/linux/beginner.html">
            
                    
                    Beginner
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.3.2" data-path="../installation/linux/expert.html">
            
                <a href="../installation/linux/expert.html">
            
                    
                    Expert
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.1.4" data-path="../installation/expert_quick_start.html">
            
                <a href="../installation/expert_quick_start.html">
            
                    
                    Expert Quick Start
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.1.5" data-path="../installation/development.html">
            
                <a href="../installation/development.html">
            
                    
                    Development
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../installation/pip.html">
            
                <a href="../installation/pip.html">
            
                    
                    Pip
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    menpo
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="introduction.html">
            
                <a href="introduction.html">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="datatypes.html">
            
                <a href="datatypes.html">
            
                    
                    Data Types
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.3" data-path="consistency.html">
            
                <a href="consistency.html">
            
                    
                    Consistency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="vectorizing.html">
            
                <a href="vectorizing.html">
            
                    
                    Vectorizing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="visualization.html">
            
                <a href="visualization.html">
            
                    
                    Visualization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" >
            
                <a target="_blank" href="https://menpo.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../menpofit/">
            
                <a href="../menpofit/">
            
                    
                    menpofit
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../menpofit/basics.html">
            
                <a href="../menpofit/basics.html">
            
                    
                    Basics
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1.1" data-path="../menpofit/importing.html">
            
                <a href="../menpofit/importing.html">
            
                    
                    Importing Images
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.2" data-path="../menpofit/training.html">
            
                <a href="../menpofit/training.html">
            
                    
                    Training
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.3" data-path="../menpofit/fitting.html">
            
                <a href="../menpofit/fitting.html">
            
                    
                    Fitting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.4" data-path="../menpofit/result.html">
            
                <a href="../menpofit/result.html">
            
                    
                    Fitting Result
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.5" data-path="../menpofit/visualization.html">
            
                <a href="../menpofit/visualization.html">
            
                    
                    Visualizing Objects
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.1.6" data-path="../menpofit/experiments.html">
            
                <a href="../menpofit/experiments.html">
            
                    
                    Running Experiments
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../menpofit/pdm.html">
            
                <a href="../menpofit/pdm.html">
            
                    
                    Point Distribution Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../menpofit/affine_image_alignment.html">
            
                <a href="../menpofit/affine_image_alignment.html">
            
                    
                    Affine Image Alignment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.3.1" data-path="../menpofit/lk.html">
            
                <a href="../menpofit/lk.html">
            
                    
                    Lucas-Kanade
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../menpofit/deformable_image_alignment.html">
            
                <a href="../menpofit/deformable_image_alignment.html">
            
                    
                    Deformable Image Alignment
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.4.1" data-path="../menpofit/atm.html">
            
                <a href="../menpofit/atm.html">
            
                    
                    Active Template Model
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../menpofit/landmark_localization.html">
            
                <a href="../menpofit/landmark_localization.html">
            
                    
                    Landmark Localization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.5.1" data-path="../menpofit/aam.html">
            
                <a href="../menpofit/aam.html">
            
                    
                    Active Appearance Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.2" data-path="../menpofit/aps.html">
            
                <a href="../menpofit/aps.html">
            
                    
                    Active Pictorial Structures
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.3" data-path="../menpofit/clm.html">
            
                <a href="../menpofit/clm.html">
            
                    
                    Constrained Local Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.4" data-path="../menpofit/sdm.html">
            
                <a href="../menpofit/sdm.html">
            
                    
                    Supervised Descent Method
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5.5" data-path="../menpofit/ert.html">
            
                <a href="../menpofit/ert.html">
            
                    
                    Ensemble of Regression Trees
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../menpofit/references.html">
            
                <a href="../menpofit/references.html">
            
                    
                    References
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" >
            
                <a target="_blank" href="https://menpofit.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../menpodetect/">
            
                <a href="../menpodetect/">
            
                    
                    menpodetect
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <a target="_blank" href="https://menpodetect.readthedocs.io/">
            
                    
                    API Documentation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../menpo3d/">
            
                <a href="../menpo3d/">
            
                    
                    menpo3d
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../menpocli/">
            
                <a href="../menpocli/">
            
                    
                    menpocli
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="../landmarkerio/">
            
                <a href="../landmarkerio/">
            
                    
                    landmarker.io
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../landmarkerio/specifications.html">
            
                <a href="../landmarkerio/specifications.html">
            
                    
                    Specifications
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../landmarkerio/userguide.html">
            
                <a href="../landmarkerio/userguide.html">
            
                    
                    User Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../landmarkerio/snap_mode.html">
            
                <a href="../landmarkerio/snap_mode.html">
            
                    
                    Snap Mode
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../examples/">
            
                <a href="../examples/">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../manifesto.html">
            
                <a href="../manifesto.html">
            
                    
                    Manifesto
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../team.html">
            
                <a href="../team.html">
            
                    
                    The Menpo Team
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../citation.html">
            
                <a href="../citation.html">
            
                    
                    Citation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../faq.html">
            
                <a href="../faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Consistency</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="consistency">Consistency</h1>
<p><code>menpo</code> takes an opinionated stance on certain issues - one of which is establishing sensible rules for how to work with spatial data and image data in the same framework.</p>
<ol>
<li><a href="#images_and_pointclouds">Working with Images and PointClouds</a></li>
<li><a href="#approach">Our Approach</a></li>
<li><a href="#keypoints">Key Points</a></li>
</ol>
<hr>
<h3 id="images_and_pointclouds">1. Working with Images and PointClouds </h3>
<p>Let&apos;s start with a quiz - which of the following is correct?</p>
<center>
  <img src="media/indexing.jpg" alt="Indexing quiz" style="width: 60%">
</center>

<p>Most would answer <strong>b</strong> - images are indexed from the top left, with <code>x</code> going across and <code>y</code> going down.</p>
<p>Now another question - how do I access that pixel in the pixels array? :</p>
<pre><code>a: lenna[30, 50]
b: lenna[50, 30]
</code></pre><p>The correct answer is <strong>b</strong> - pixels get stored in a <code>y</code>, <code>x</code> order so we have to flip the points to access the array.</p>
<p>As <code>menpo</code> blends together use of <code>PointClouds</code> and <code>Images</code> frequently this can cause a lot of confusion. You might create a <code>Translation</code> of <code>5</code> in the <code>y</code> direction as the following:</p>
<pre><code class="lang-python">t = menpo.transform.Translation([<span class="hljs-number">0</span>, <span class="hljs-number">5</span>])
</code></pre>
<p>And then expect to use it to warp an image:</p>
<pre><code class="lang-python">img.warp_to(reference_shape, t)
</code></pre>
<p>and then some spatial data related to the image:</p>
<pre><code class="lang-python">t.apply(some_data)
</code></pre>
<p>Unfortunately the meaning of <code>y</code> in these two domains is different - some code would have to flip the order of applying the translation of the transform to an image, a potential cause of confusion.</p>
<p>The <em>worst</em> part about this is that once we go to voxel data (which <code>Image</code> largely supports, and will fully support in the future), a <code>z</code>-axis is added.</p>
<p><strong>There is one important caveat</strong>, unfortunately. The <strong>first axis of an image represents the channels</strong>. Unlike in other software, such as Matlab, which follows the fortran convention of being column major, Python and other C-like languages generally conform to a row major order. Practically this means that if you want to iterate over each channel of an image, you need the memory layout to reflect this. This means you want the pixel data of each channel to be contiguous in memory. <strong>For row major memory, this implies that the first axis should represent an iteration over the channel data.</strong></p>
<p>Now, as was mentioned, we want to drop all the swapping business. Therefore, forgiving that the <strong>first axis indexes the channel data</strong>, the following axes always match the spatial data. For example, The zeroth axis of the spatial data once more corresponds with the first axis (the first axis is <em>after the zeroth axis representing the channel data</em>) of the image data. Trying to keep track of these rules muddies an otherwise very simple concept.</p>
<h3 id="approach">2. Our Approach </h3>
<p><code>menpo</code>&apos;s solution to this problem is simple - <strong>drop the insistence of calling axes <code>x</code>, <code>y</code>, and <code>z</code></strong>. Skipping the channel data, which represents the zeroth axis, the first axis of the pixel data is simply that - the first axis. It corresponds exactly with the zeroth axis on the point cloud. If you have an image with annotations provided the zeroth axis of the <code>PointCloud</code> representing the annotations will correspond with the first axis of the image. This rule makes working with images and spatial data simple -short you should never have to think about flipping axes in <code>menpo</code>.</p>
<p>It&apos;s natural to be concerned at this point that establishing such rules must make it really difficult ingest data which follows different conventions. This is incorrect - one of the biggest strengths of the <a href="http://docs.menpo.org/en/stable/api/menpo/io/index.html" target="_blank">menpo.io</a> module is that each asset importer normalizes the format of the data to format <code>menpo</code>&apos;s rules.</p>
<h3 id="keypoints">3. Key Points </h3>
<ul>
<li><strong>Menpo is n-dimensional</strong>. We try and avoid speaking of <code>x</code> and <code>y</code>, because there are many different conventions in use.</li>
<li><strong>The IO module ensures that different data formats are normalized</strong> upon loading into <code>menpo</code>. For example, <code>Image</code> types are imported as 64-bit floating point numbers normalised between [0, 1], by default.</li>
<li><strong>axis 0 of landmarks corresponds to axis 0 of the container it is an annotation of</strong>.</li>
<li><strong>The first axis of image types is always the channel data. The remaining axes map exactly to the other spatial axes.</strong> Therefore, the first image axis maps exactly to the zeroth axis of a <code>PointCloud</code>.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="datatypes.html" class="navigation navigation-prev " aria-label="Previous page: Data Types">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="vectorizing.html" class="navigation navigation-next " aria-label="Next page: Vectorizing">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Consistency","level":"1.3.3","depth":2,"next":{"title":"Vectorizing","level":"1.3.4","depth":2,"path":"menpo/vectorizing.md","ref":"menpo/vectorizing.md","articles":[]},"previous":{"title":"Data Types","level":"1.3.2","depth":2,"path":"menpo/datatypes.md","ref":"menpo/datatypes.md","articles":[]},"dir":"ltr"},"config":{"plugins":["toggle-chapters","katex","ga"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"ga":{"configuration":"auto","token":"UA-52093814-1"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false},"toggle-chapters":{}},"theme":"default","author":"The Menpo Team","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"homepage.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"The Menpo Project","gitbook":"3.2.3"},"file":{"path":"menpo/consistency.md","mtime":"2019-11-16T13:08:54.328Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-11-16T13:57:33.647Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-ga/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

